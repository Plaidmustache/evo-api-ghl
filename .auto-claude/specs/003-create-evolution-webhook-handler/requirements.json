{
  "task_description": "Update webhook handling to receive and parse Evolution API webhook events.\n\n## Rename and update: src/webhooks/guards/greenapi-webhook.guard.ts → evolution-webhook.guard.ts\n\n- Rename class from GreenApiWebhookGuard to EvolutionWebhookGuard\n- Update validation logic for Evolution API webhook format\n- Validate that the instance exists in our database by instanceName\n\n## Update: src/webhooks/webhooks.controller.ts\n\n1. Change endpoint from @Post('green-api') to @Post('evolution')\n\n2. Update the webhook handler to parse Evolution API format:\n\nEvolution API sends webhooks like:\n{\n  \"event\": \"messages.upsert\",\n  \"instance\": \"my-instance\",\n  \"data\": {\n    \"key\": {\n      \"remoteJid\": \"5511999999999@s.whatsapp.net\",\n      \"fromMe\": false,\n      \"id\": \"ABC123\"\n    },\n    \"pushName\": \"John Doe\",\n    \"message\": {\n      \"conversation\": \"Hello!\"\n    },\n    \"messageType\": \"conversation\",\n    \"messageTimestamp\": 1704067200\n  }\n}\n\n3. Handle these event types:\n   - messages.upsert → incoming message, route to GHL\n   - connection.update → state change, update instance state in DB\n\n4. Extract phone number from remoteJid by removing @s.whatsapp.net or @g.us suffix\n\n5. Update guard decorator from @UseGuards(GreenApiWebhookGuard) to @UseGuards(EvolutionWebhookGuard)\n\n## Update: src/webhooks/webhooks.module.ts\n- Update imports to use new guard name",
  "workflow_type": "feature"
}