{
  "task_description": "Update the main GHL service to use Evolution API instead of GREEN-API SDK.\n\n## Update: src/ghl/ghl.service.ts\n\n### Remove:\n- Remove import of @green-api/greenapi-integration package\n- Remove createGreenApiClient() method\n- Remove any GreenApiLogger usage (replace with NestJS Logger)\n\n### Add:\n- Import EvolutionApiClient from ../evolution/evolution-api.client\n- Import updated transformer methods\n\n### Update createGreenApiInstanceForUser() → createEvolutionInstanceForUser():\n\nParameters change from (locationId, idInstance, apiToken, name) to:\n(locationId, instanceName, evolutionApiUrl, evolutionApiKey, name)\n\nMethod should:\n1. Create EvolutionApiClient with provided URL and key\n2. Call getConnectionState() to verify instance exists and get current state\n3. Call setWebhook() to register our webhook URL for events: ['MESSAGES_UPSERT', 'CONNECTION_UPDATE']\n4. Save instance to database with new schema fields\n5. Return the created instance\n\n### Update handleGreenApiWebhook() → handleEvolutionWebhook():\n\n- Parse Evolution webhook format (event, instance, data)\n- Look up instance by instanceName instead of idInstance\n- Route to appropriate handler based on event type\n- For messages.upsert: transform and send to GHL\n- For connection.update: update instance state in DB\n\n### Update message sending methods:\n\nWhen GHL sends outbound message:\n1. Look up instance by the conversation provider tag\n2. Create EvolutionApiClient for that instance\n3. Use transformer.toEvolutionMessage() to format\n4. Call client.sendText() or client.sendMedia()\n\n### Update: src/ghl/ghl.module.ts\n- Import EvolutionModule\n- Update providers if needed",
  "workflow_type": "feature"
}